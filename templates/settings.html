{% extends "base.html" %}

{% block title %}Settings - Attack Surface Monitoring{% endblock %}

{% block content %}
<div class="flex h-screen overflow-hidden bg-slate-900">
    <!-- Sidebar -->
    <div id="sidebar" class="bg-slate-800 flex flex-col text-white transition-all duration-300 ease-in-out w-16 border-r border-slate-700">
        <!-- Logo Section -->
        <div class="flex items-center justify-center py-4 mb-4">
            <div class="w-10 h-10 flex items-center justify-center">
                <i class="ri-shield-keyhole-line ri-lg text-primary"></i>
            </div>
            <span id="logo-text" class="ml-3 text-lg font-semibold text-primary opacity-0 transition-opacity duration-300 whitespace-nowrap">AttackSurface</span>
        </div>

        <!-- Navigation Items -->
        <nav class="flex-1 px-2">
            <!-- Dashboard -->
            <div class="nav-item mb-2 p-3 rounded-lg cursor-pointer hover:bg-slate-700 transition-colors relative" onclick="window.location.href='/dashboard'" title="Dashboard">
                <div class="flex items-center">
                    <i class="ri-dashboard-line ri-lg min-w-[24px]"></i>
                    <span class="nav-text ml-3 opacity-0 transition-opacity duration-300 whitespace-nowrap">Dashboard</span>
                </div>
            </div>

            <!-- Assets -->
            <div class="nav-item mb-2 p-3 rounded-lg cursor-pointer hover:bg-slate-700 transition-colors relative" onclick="window.location.href='/assets'" title="Assets">
                <div class="flex items-center">
                    <i class="ri-computer-line ri-lg min-w-[24px]"></i>
                    <span class="nav-text ml-3 opacity-0 transition-opacity duration-300 whitespace-nowrap">Assets</span>
                </div>
            </div>

            <!-- Vulnerabilities -->
            <div class="nav-item mb-2 p-3 rounded-lg cursor-pointer hover:bg-slate-700 transition-colors relative" onclick="window.location.href='/vulnerabilities'" title="Vulnerabilities">
                <div class="flex items-center">
                    <i class="ri-bug-line ri-lg min-w-[24px]"></i>
                    <span class="nav-text ml-3 opacity-0 transition-opacity duration-300 whitespace-nowrap">Vulnerabilities</span>
                </div>
            </div>

            <!-- Technologies -->
            <div class="nav-item mb-2 p-3 rounded-lg cursor-pointer hover:bg-slate-700 transition-colors relative" onclick="window.location.href='/technologies'" title="Technology Discovery">
                <div class="flex items-center">
                    <i class="ri-stack-line ri-lg min-w-[24px]"></i>
                    <span class="nav-text ml-3 opacity-0 transition-opacity duration-300 whitespace-nowrap">Technologies</span>
                </div>
            </div>

            <!-- Reports -->
            <div class="nav-item mb-2 p-3 rounded-lg cursor-pointer hover:bg-slate-700 transition-colors relative" onclick="window.location.href='/reports'" title="Reports">
                <div class="flex items-center">
                    <i class="ri-file-chart-line ri-lg min-w-[24px]"></i>
                    <span class="nav-text ml-3 opacity-0 transition-opacity duration-300 whitespace-nowrap">Reports</span>
                </div>
            </div>

            <!-- Settings -->
            <div class="nav-item mb-2 p-3 rounded-lg cursor-pointer hover:bg-slate-700 transition-colors bg-slate-700 relative" title="Settings">
                <div class="flex items-center">
                    <i class="ri-settings-3-line ri-lg min-w-[24px]"></i>
                    <span class="nav-text ml-3 opacity-0 transition-opacity duration-300 whitespace-nowrap">Settings</span>
                </div>
            </div>
        </nav>

        <!-- Toggle Button -->
        <div class="p-2">
            <button id="sidebar-toggle" class="w-full p-3 rounded-lg hover:bg-slate-700 transition-colors flex items-center justify-center" title="Toggle Sidebar">
                <i class="ri-menu-line ri-lg min-w-[24px]"></i>
                <span id="toggle-text" class="nav-text ml-3 opacity-0 transition-opacity duration-300 whitespace-nowrap">Expand</span>
            </button>
        </div>
    </div>

    <!-- Mobile Sidebar Overlay -->
    <div id="sidebar-overlay" class="fixed inset-0 bg-black bg-opacity-50 z-40 hidden lg:hidden"></div>

    <!-- Main Content -->
    <div class="flex-1 flex flex-col overflow-hidden">
        <!-- Header -->
        <header class="h-16 border-b border-slate-700 bg-slate-800 flex items-center justify-between px-4 md:px-6">
            <!-- Mobile menu button -->
            <button id="mobile-menu-btn" class="lg:hidden p-2 rounded-lg hover:bg-slate-700 transition-colors">
                <i class="ri-menu-line text-xl text-white"></i>
            </button>

            <div class="flex items-center justify-between w-full lg:w-auto">
                <h1 class="text-xl md:text-2xl font-bold text-white">Settings</h1>
            </div>

            <!-- User Menu -->
            <div class="relative">
                <button class="w-10 h-10 flex items-center justify-center rounded-full bg-slate-700 hover:bg-slate-600 transition-colors" onclick="toggleUserMenu()">
                    <i class="ri-user-line text-white"></i>
                </button>
                <div id="userMenu" class="hidden absolute right-0 mt-2 w-48 bg-slate-800 border border-slate-700 rounded-lg shadow-xl py-1 z-50">
                    <a href="#" class="block px-4 py-2 text-sm text-slate-300 hover:bg-slate-700 hover:text-white transition-colors">Profile</a>
                    <a href="{{ url_for('auth.logout') }}" class="block px-4 py-2 text-sm text-slate-300 hover:bg-slate-700 hover:text-white transition-colors">Logout</a>
                </div>
            </div>
        </header>

        <!-- Settings Content -->
        <div class="flex-1 overflow-y-auto p-4 md:p-6">
            <!-- Page Title -->
            <div class="mb-6">
                <div class="flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4 mb-6">
                    <div>
                        <h2 class="text-xl md:text-2xl font-bold mb-2 text-white">System Configuration</h2>
                        <div class="flex flex-wrap items-center gap-4 text-sm text-slate-400">
                            <div class="flex items-center gap-2">
                                <span>Manage application settings and preferences</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Settings Tabs -->
                <div class="bg-slate-800/50 border border-slate-700 rounded-lg p-1 mb-6">
                    <div class="flex flex-wrap gap-1">
                        <button class="settings-tab active flex-1 min-w-0 px-3 md:px-4 py-2 text-sm font-medium rounded-md bg-primary text-slate-900 transition-all duration-200" data-tab="general">
                            <i class="ri-settings-line mr-1 md:mr-2"></i>
                            <span class="hidden sm:inline">General</span>
                            <span class="sm:hidden">Gen</span>
                        </button>
                        <button class="settings-tab flex-1 min-w-0 px-3 md:px-4 py-2 text-sm font-medium rounded-md text-slate-400 hover:text-white hover:bg-slate-700/50 transition-all duration-200" data-tab="scanning">
                            <i class="ri-radar-line mr-1 md:mr-2"></i>
                            <span class="hidden sm:inline">Scanning</span>
                            <span class="sm:hidden">Scan</span>
                        </button>
                        <button class="settings-tab flex-1 min-w-0 px-3 md:px-4 py-2 text-sm font-medium rounded-md text-slate-400 hover:text-white hover:bg-slate-700/50 transition-all duration-200" data-tab="notifications">
                            <i class="ri-notification-line mr-1 md:mr-2"></i>
                            <span class="hidden sm:inline">Notifications</span>
                            <span class="sm:hidden">Notif</span>
                        </button>
                        <button class="settings-tab flex-1 min-w-0 px-3 md:px-4 py-2 text-sm font-medium rounded-md text-slate-400 hover:text-white hover:bg-slate-700/50 transition-all duration-200" data-tab="users">
                            <i class="ri-team-line mr-1 md:mr-2"></i>
                            <span class="hidden sm:inline">Users</span>
                            <span class="sm:hidden">Users</span>
                        </button>
                        <button class="settings-tab flex-1 min-w-0 px-3 md:px-4 py-2 text-sm font-medium rounded-md text-slate-400 hover:text-white hover:bg-slate-700/50 transition-all duration-200" data-tab="data">
                            <i class="ri-database-line mr-1 md:mr-2"></i>
                            <span class="hidden sm:inline">Data</span>
                            <span class="sm:hidden">Data</span>
                        </button>
                        <button class="settings-tab flex-1 min-w-0 px-3 md:px-4 py-2 text-sm font-medium rounded-md text-slate-400 hover:text-white hover:bg-slate-700/50 transition-all duration-200" data-tab="integrations">
                            <i class="ri-plug-line mr-1 md:mr-2"></i>
                            <span class="hidden sm:inline">Integrations</span>
                            <span class="sm:hidden">Int</span>
                        </button>
                    </div>
                </div>
            </div>

            <!-- Tab Content -->
            <div class="settings-content">
                <!-- General Settings Tab -->
                <div id="general-tab" class="tab-content">
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <!-- Organization Details -->
                        <div class="card bg-slate-800/50 border border-slate-700 rounded-lg p-4 md:p-6">
                            <h3 class="text-lg font-semibold text-white mb-4">
                                <i class="ri-building-line mr-2 text-primary"></i>Organization Details
                            </h3>
                            <form id="organization-form" class="space-y-4">
                                <div>
                                    <label class="block text-sm font-medium text-slate-400 mb-2">Organization Name</label>
                                    <input type="text" id="org-name" value="{{ organization.name }}"
                                           class="w-full px-3 py-2 bg-slate-700 border border-slate-600 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary text-white placeholder-slate-400">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-slate-400 mb-2">Primary Domain</label>
                                    <input type="text" id="primary-domain" placeholder="example.com"
                                           class="w-full px-3 py-2 bg-slate-700 border border-slate-600 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary text-white placeholder-slate-400">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-slate-400 mb-2">Description</label>
                                    <textarea id="org-description" rows="3" placeholder="Organization description..."
                                              class="w-full px-3 py-2 bg-slate-700 border border-slate-600 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary text-white placeholder-slate-400"></textarea>
                                </div>
                                <button type="submit" class="w-full bg-primary hover:bg-primary/90 text-slate-900 py-2 px-4 rounded-lg transition-all duration-200 font-medium shadow-lg hover:shadow-xl hover:scale-105">
                                    Save Organization Details
                                </button>
                            </form>
                        </div>

                        <!-- Interface Preferences -->
                        <div class="card bg-slate-800/50 border border-slate-700 rounded-lg p-4 md:p-6">
                            <h3 class="text-lg font-semibold text-white mb-4">
                                <i class="ri-palette-line mr-2 text-primary"></i>Interface Preferences
                            </h3>
                            <form id="interface-form" class="space-y-4">
                                <div>
                                    <label class="block text-sm font-medium text-slate-400 mb-2">Default View</label>
                                    <select id="default-view" class="w-full px-3 py-2 bg-slate-700 border border-slate-600 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary text-white">
                                        <option value="dashboard">Dashboard</option>
                                        <option value="assets">Assets</option>
                                        <option value="vulnerabilities">Vulnerabilities</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-slate-400 mb-2">Theme</label>
                                    <select id="theme" class="w-full px-3 py-2 bg-slate-700 border border-slate-600 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary text-white">
                                        <option value="light">Light</option>
                                        <option value="dark" selected>Dark</option>
                                        <option value="auto">Auto</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-slate-400 mb-2">Items per Page</label>
                                    <select id="items-per-page" class="w-full px-3 py-2 bg-slate-700 border border-slate-600 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary text-white">
                                        <option value="10">10</option>
                                        <option value="25" selected>25</option>
                                        <option value="50">50</option>
                                        <option value="100">100</option>
                                    </select>
                                </div>
                                <div class="flex items-center">
                                    <input type="checkbox" id="sidebar-expanded" class="h-4 w-4 text-primary focus:ring-primary border-slate-600 bg-slate-700 rounded">
                                    <label for="sidebar-expanded" class="ml-2 block text-sm text-slate-300">Keep sidebar expanded by default</label>
                                </div>
                                <button type="submit" class="w-full bg-primary hover:bg-primary/90 text-slate-900 py-2 px-4 rounded-lg transition-all duration-200 font-medium shadow-lg hover:shadow-xl hover:scale-105">
                                    Save Interface Preferences
                                </button>
                            </form>
                        </div>
                    </div>
                </div>

                <!-- Scanning Configuration Tab -->
                <div id="scanning-tab" class="tab-content hidden">
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <!-- Auto-scan Settings -->
                        <div class="card bg-slate-800/50 border border-slate-700 rounded-lg p-4 md:p-6">
                            <h3 class="text-lg font-semibold text-white mb-4">
                                <i class="ri-timer-line mr-2 text-primary"></i>Auto-scan Configuration
                            </h3>
                            <form id="autoscan-form" class="space-y-4">
                                <div class="flex items-center">
                                    <input type="checkbox" id="auto-scan-enabled" class="h-4 w-4 text-primary focus:ring-primary border-slate-600 bg-slate-700 rounded">
                                    <label for="auto-scan-enabled" class="ml-2 block text-sm text-slate-300">Enable auto-scan for new assets</label>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-slate-400 mb-2">Scan Frequency</label>
                                    <select id="scan-frequency" class="w-full px-3 py-2 bg-slate-700 border border-slate-600 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary text-white">
                                        <option value="daily">Daily</option>
                                        <option value="weekly" selected>Weekly</option>
                                        <option value="monthly">Monthly</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-slate-400 mb-2">Scan Time</label>
                                    <input type="time" id="scan-time" value="02:00"
                                           class="w-full px-3 py-2 bg-slate-700 border border-slate-600 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary text-white">
                                </div>
                                <div class="flex items-center">
                                    <input type="checkbox" id="deep-scan" class="h-4 w-4 text-primary focus:ring-primary border-slate-600 bg-slate-700 rounded">
                                    <label for="deep-scan" class="ml-2 block text-sm text-slate-300">Enable deep scanning (slower but more thorough)</label>
                                </div>
                                <button type="submit" class="w-full bg-primary hover:bg-primary/90 text-slate-900 py-2 px-4 rounded-lg transition-all duration-200 font-medium shadow-lg hover:shadow-xl hover:scale-105">
                                    Save Auto-scan Settings
                                </button>
                            </form>
                        </div>

                        <!-- Technology Detection -->
                        <div class="card bg-slate-800/50 border border-slate-700 rounded-lg p-4 md:p-6">
                            <h3 class="text-lg font-semibold text-white mb-4">
                                <i class="ri-stack-line mr-2 text-primary"></i>Technology Detection
                            </h3>
                            <form id="tech-detection-form" class="space-y-4">
                                <div class="flex items-center">
                                    <input type="checkbox" id="tech-detection-enabled" checked class="h-4 w-4 text-primary focus:ring-primary border-slate-600 bg-slate-700 rounded">
                                    <label for="tech-detection-enabled" class="ml-2 block text-sm text-slate-300">Enable technology detection</label>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-slate-400 mb-2">Detection Tools</label>
                                    <div class="space-y-2">
                                        <div class="flex items-center">
                                            <input type="checkbox" id="wappalyzer" checked class="h-4 w-4 text-primary focus:ring-primary border-slate-600 bg-slate-700 rounded">
                                            <label for="wappalyzer" class="ml-2 block text-sm text-slate-300">Wappalyzer</label>
                                        </div>
                                        <div class="flex items-center">
                                            <input type="checkbox" id="httpx" checked class="h-4 w-4 text-primary focus:ring-primary border-slate-600 bg-slate-700 rounded">
                                            <label for="httpx" class="ml-2 block text-sm text-slate-300">httpx</label>
                                        </div>
                                        <div class="flex items-center">
                                            <input type="checkbox" id="nuclei-tech" checked class="h-4 w-4 text-primary focus:ring-primary border-slate-600 bg-slate-700 rounded">
                                            <label for="nuclei-tech" class="ml-2 block text-sm text-slate-300">Nuclei (tech detection)</label>
                                        </div>
                                    </div>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-slate-400 mb-2">Update Frequency</label>
                                    <select id="tech-update-frequency" class="w-full px-3 py-2 bg-slate-700 border border-slate-600 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary text-white">
                                        <option value="daily">Daily</option>
                                        <option value="weekly" selected>Weekly</option>
                                        <option value="monthly">Monthly</option>
                                    </select>
                                </div>
                                <button type="submit" class="w-full bg-primary hover:bg-primary/90 text-slate-900 py-2 px-4 rounded-lg transition-all duration-200 font-medium shadow-lg hover:shadow-xl hover:scale-105">
                                    Save Technology Settings
                                </button>
                            </form>
                        </div>

                        <!-- Scan Performance -->
                        <div class="card bg-slate-800/50 border border-slate-700 rounded-lg p-4 md:p-6">
                            <h3 class="text-lg font-semibold text-white mb-4">
                                <i class="ri-speed-line mr-2 text-primary"></i>Scan Performance
                            </h3>
                            <form id="performance-form" class="space-y-4">
                                <div>
                                    <label class="block text-sm font-medium text-slate-400 mb-2">Concurrent Scans</label>
                                    <input type="range" id="concurrent-scans" min="1" max="10" value="3"
                                           class="w-full h-2 bg-slate-700 rounded-lg appearance-none cursor-pointer slider">
                                    <div class="flex justify-between text-xs text-slate-400 mt-1">
                                        <span>1</span>
                                        <span id="concurrent-value" class="text-primary font-medium">3</span>
                                        <span>10</span>
                                    </div>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-slate-400 mb-2">Timeout (seconds)</label>
                                    <input type="number" id="scan-timeout" value="300" min="60" max="3600"
                                           class="w-full px-3 py-2 bg-slate-700 border border-slate-600 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary text-white">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-slate-400 mb-2">Rate Limit (requests/sec)</label>
                                    <input type="number" id="rate-limit" value="100" min="10" max="1000"
                                           class="w-full px-3 py-2 bg-slate-700 border border-slate-600 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary text-white">
                                </div>
                                <button type="submit" class="w-full bg-primary hover:bg-primary/90 text-slate-900 py-2 px-4 rounded-lg transition-all duration-200 font-medium shadow-lg hover:shadow-xl hover:scale-105">
                                    Save Performance Settings
                                </button>
                            </form>
                        </div>
                    </div>
                </div>

                <!-- Notifications Tab -->
                <div id="notifications-tab" class="tab-content hidden">
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <!-- Email Notifications -->
                        <div class="card bg-slate-800/50 border border-slate-700 rounded-lg p-4 md:p-6">
                            <h3 class="text-lg font-semibold text-white mb-4">
                                <i class="ri-mail-line mr-2 text-primary"></i>Email Notifications
                            </h3>
                            <form id="email-notifications-form" class="space-y-4">
                                <div class="flex items-center">
                                    <input type="checkbox" id="email-enabled" checked class="h-4 w-4 text-primary focus:ring-primary border-slate-600 bg-slate-700 rounded">
                                    <label for="email-enabled" class="ml-2 block text-sm text-slate-300">Enable email notifications</label>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-slate-400 mb-2">Notification Email</label>
                                    <input type="email" id="notification-email" value="{{ current_user.email }}"
                                           class="w-full px-3 py-2 bg-slate-700 border border-slate-600 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary text-white placeholder-slate-400">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-slate-400 mb-2">Additional Recipients</label>
                                    <textarea id="additional-emails" rows="3" placeholder="email1@example.com, email2@example.com"
                                              class="w-full px-3 py-2 bg-slate-700 border border-slate-600 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary text-white placeholder-slate-400"></textarea>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-slate-400 mb-2">Digest Frequency</label>
                                    <select id="digest-frequency" class="w-full px-3 py-2 bg-slate-700 border border-slate-600 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary text-white">
                                        <option value="immediate">Immediate</option>
                                        <option value="hourly">Hourly</option>
                                        <option value="daily" selected>Daily</option>
                                        <option value="weekly">Weekly</option>
                                    </select>
                                </div>
                                <button type="submit" class="w-full bg-primary hover:bg-primary/90 text-slate-900 py-2 px-4 rounded-lg transition-all duration-200 font-medium shadow-lg hover:shadow-xl hover:scale-105">
                                    Save Email Settings
                                </button>
                            </form>
                        </div>

                        <!-- Alert Thresholds -->
                        <div class="card bg-slate-800/50 border border-slate-700 rounded-lg p-4 md:p-6">
                            <h3 class="text-lg font-semibold text-white mb-4">
                                <i class="ri-alarm-warning-line mr-2 text-primary"></i>Alert Severity Thresholds
                            </h3>
                            <form id="alert-thresholds-form" class="space-y-4">
                                <div class="space-y-3">
                                    <div class="flex items-center justify-between">
                                        <div class="flex items-center">
                                            <input type="checkbox" id="critical-alerts" checked class="h-4 w-4 text-red-400 focus:ring-red-400 border-slate-600 bg-slate-700 rounded">
                                            <label for="critical-alerts" class="ml-2 block text-sm text-slate-300">Critical</label>
                                        </div>
                                        <span class="px-2 py-1 text-xs font-medium bg-red-500/20 text-red-400 border border-red-500/30 rounded-full">Immediate</span>
                                    </div>
                                    <div class="flex items-center justify-between">
                                        <div class="flex items-center">
                                            <input type="checkbox" id="high-alerts" checked class="h-4 w-4 text-orange-400 focus:ring-orange-400 border-slate-600 bg-slate-700 rounded">
                                            <label for="high-alerts" class="ml-2 block text-sm text-slate-300">High</label>
                                        </div>
                                        <span class="px-2 py-1 text-xs font-medium bg-orange-500/20 text-orange-400 border border-orange-500/30 rounded-full">Immediate</span>
                                    </div>
                                    <div class="flex items-center justify-between">
                                        <div class="flex items-center">
                                            <input type="checkbox" id="medium-alerts" checked class="h-4 w-4 text-yellow-400 focus:ring-yellow-400 border-slate-600 bg-slate-700 rounded">
                                            <label for="medium-alerts" class="ml-2 block text-sm text-slate-300">Medium</label>
                                        </div>
                                        <span class="px-2 py-1 text-xs font-medium bg-yellow-500/20 text-yellow-400 border border-yellow-500/30 rounded-full">Daily</span>
                                    </div>
                                    <div class="flex items-center justify-between">
                                        <div class="flex items-center">
                                            <input type="checkbox" id="low-alerts" class="h-4 w-4 text-blue-400 focus:ring-blue-400 border-slate-600 bg-slate-700 rounded">
                                            <label for="low-alerts" class="ml-2 block text-sm text-slate-300">Low</label>
                                        </div>
                                        <span class="px-2 py-1 text-xs font-medium bg-blue-500/20 text-blue-400 border border-blue-500/30 rounded-full">Weekly</span>
                                    </div>
                                    <div class="flex items-center justify-between">
                                        <div class="flex items-center">
                                            <input type="checkbox" id="info-alerts" class="h-4 w-4 text-slate-400 focus:ring-slate-400 border-slate-600 bg-slate-700 rounded">
                                            <label for="info-alerts" class="ml-2 block text-sm text-slate-300">Info</label>
                                        </div>
                                        <span class="px-2 py-1 text-xs font-medium bg-slate-500/20 text-slate-400 border border-slate-500/30 rounded-full">Weekly</span>
                                    </div>
                                </div>
                                <button type="submit" class="w-full bg-primary hover:bg-primary/90 text-slate-900 py-2 px-4 rounded-lg transition-all duration-200 font-medium shadow-lg hover:shadow-xl hover:scale-105">
                                    Save Alert Settings
                                </button>
                            </form>
                        </div>
                    </div>
                </div>

                <!-- Users Tab -->
                <div id="users-tab" class="tab-content hidden">
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <!-- User Management -->
                        <div class="card bg-slate-800/50 border border-slate-700 rounded-lg p-4 md:p-6">
                            <h3 class="text-lg font-semibold text-white mb-4">
                                <i class="ri-user-settings-line mr-2 text-primary"></i>User Management
                            </h3>
                            <div class="space-y-4">
                                <div class="flex items-center justify-between p-3 bg-slate-700/50 border border-slate-600 rounded-lg">
                                    <div class="flex items-center">
                                        <div class="w-8 h-8 bg-primary rounded-full flex items-center justify-center">
                                            <i class="ri-user-line text-slate-900 text-sm"></i>
                                        </div>
                                        <div class="ml-3">
                                            <p class="text-sm font-medium text-white">{{ current_user.username }}</p>
                                            <p class="text-xs text-slate-400">{{ current_user.email }}</p>
                                        </div>
                                    </div>
                                    <span class="px-2 py-1 text-xs font-medium bg-green-500/20 text-green-400 border border-green-500/30 rounded-full">Owner</span>
                                </div>
                                <button class="w-full bg-primary hover:bg-primary/90 text-slate-900 py-2 px-4 rounded-lg transition-all duration-200 font-medium shadow-lg hover:shadow-xl hover:scale-105">
                                    <i class="ri-user-add-line mr-2"></i>Invite Team Member
                                </button>
                            </div>
                        </div>

                        <!-- Permissions -->
                        <div class="card bg-slate-800/50 border border-slate-700 rounded-lg p-4 md:p-6">
                            <h3 class="text-lg font-semibold text-white mb-4">
                                <i class="ri-shield-user-line mr-2 text-primary"></i>Default Permissions
                            </h3>
                            <form id="permissions-form" class="space-y-4">
                                <div class="space-y-3">
                                    <div class="flex items-center justify-between">
                                        <label class="text-sm text-slate-300">View Assets</label>
                                        <input type="checkbox" checked class="h-4 w-4 text-primary focus:ring-primary border-slate-600 bg-slate-700 rounded">
                                    </div>
                                    <div class="flex items-center justify-between">
                                        <label class="text-sm text-slate-300">Add Assets</label>
                                        <input type="checkbox" checked class="h-4 w-4 text-primary focus:ring-primary border-slate-600 bg-slate-700 rounded">
                                    </div>
                                    <div class="flex items-center justify-between">
                                        <label class="text-sm text-slate-300">Run Scans</label>
                                        <input type="checkbox" class="h-4 w-4 text-primary focus:ring-primary border-slate-600 bg-slate-700 rounded">
                                    </div>
                                    <div class="flex items-center justify-between">
                                        <label class="text-sm text-slate-300">View Reports</label>
                                        <input type="checkbox" checked class="h-4 w-4 text-primary focus:ring-primary border-slate-600 bg-slate-700 rounded">
                                    </div>
                                    <div class="flex items-center justify-between">
                                        <label class="text-sm text-slate-300">Manage Settings</label>
                                        <input type="checkbox" class="h-4 w-4 text-primary focus:ring-primary border-slate-600 bg-slate-700 rounded">
                                    </div>
                                </div>
                                <button type="submit" class="w-full bg-primary hover:bg-primary/90 text-slate-900 py-2 px-4 rounded-lg transition-all duration-200 font-medium shadow-lg hover:shadow-xl hover:scale-105">
                                    Save Permissions
                                </button>
                            </form>
                        </div>

                        <!-- Activity Logs -->
                        <div class="card bg-slate-800/50 border border-slate-700 rounded-lg p-4 md:p-6 lg:col-span-2">
                            <h3 class="text-lg font-semibold text-white mb-4">
                                <i class="ri-history-line mr-2 text-primary"></i>Recent Activity
                            </h3>
                            <div class="space-y-3 max-h-64 overflow-y-auto">
                                <div class="flex items-center p-3 bg-slate-700/50 border border-slate-600 rounded-lg">
                                    <div class="w-8 h-8 bg-green-500/20 border border-green-500/30 rounded-full flex items-center justify-center">
                                        <i class="ri-login-circle-line text-green-400 text-sm"></i>
                                    </div>
                                    <div class="ml-3 flex-1">
                                        <p class="text-sm text-white">User logged in</p>
                                        <p class="text-xs text-slate-400">{{ current_user.username }} • Just now</p>
                                    </div>
                                </div>
                                <div class="flex items-center p-3 bg-slate-700/50 border border-slate-600 rounded-lg">
                                    <div class="w-8 h-8 bg-blue-500/20 border border-blue-500/30 rounded-full flex items-center justify-center">
                                        <i class="ri-settings-line text-blue-400 text-sm"></i>
                                    </div>
                                    <div class="ml-3 flex-1">
                                        <p class="text-sm text-white">Settings accessed</p>
                                        <p class="text-xs text-slate-400">{{ current_user.username }} • 2 minutes ago</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Data Management Tab -->
                <div id="data-tab" class="tab-content hidden">
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <!-- Data Retention -->
                        <div class="card bg-slate-800/50 border border-slate-700 rounded-lg p-4 md:p-6">
                            <h3 class="text-lg font-semibold text-white mb-4">
                                <i class="ri-time-line mr-2 text-primary"></i>Data Retention Policies
                            </h3>
                            <form id="retention-form" class="space-y-4">
                                <div>
                                    <label class="block text-sm font-medium text-slate-400 mb-2">Scan Results Retention</label>
                                    <select id="scan-retention" class="w-full px-3 py-2 bg-slate-700 border border-slate-600 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary text-white">
                                        <option value="30">30 days</option>
                                        <option value="90" selected>90 days</option>
                                        <option value="180">6 months</option>
                                        <option value="365">1 year</option>
                                        <option value="0">Never delete</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-slate-400 mb-2">Vulnerability Data Retention</label>
                                    <select id="vuln-retention" class="w-full px-3 py-2 bg-slate-700 border border-slate-600 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary text-white">
                                        <option value="90">90 days</option>
                                        <option value="180">6 months</option>
                                        <option value="365" selected>1 year</option>
                                        <option value="730">2 years</option>
                                        <option value="0">Never delete</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-slate-400 mb-2">Alert History Retention</label>
                                    <select id="alert-retention" class="w-full px-3 py-2 bg-slate-700 border border-slate-600 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary text-white">
                                        <option value="30">30 days</option>
                                        <option value="90" selected>90 days</option>
                                        <option value="180">6 months</option>
                                        <option value="365">1 year</option>
                                    </select>
                                </div>
                                <button type="submit" class="w-full bg-primary hover:bg-primary/90 text-slate-900 py-2 px-4 rounded-lg transition-all duration-200 font-medium shadow-lg hover:shadow-xl hover:scale-105">
                                    Save Retention Policies
                                </button>
                            </form>
                        </div>

                        <!-- Export/Import -->
                        <div class="card bg-slate-800/50 border border-slate-700 rounded-lg p-4 md:p-6">
                            <h3 class="text-lg font-semibold text-white mb-4">
                                <i class="ri-download-cloud-line mr-2 text-primary"></i>Export/Import Data
                            </h3>
                            <div class="space-y-4">
                                <div>
                                    <label class="block text-sm font-medium text-slate-400 mb-2">Export Data</label>
                                    <div class="space-y-2">
                                        <button class="w-full bg-green-600 hover:bg-green-700 text-white py-2 px-4 rounded-lg transition-all duration-200 font-medium shadow-lg hover:shadow-xl hover:scale-105">
                                            <i class="ri-file-excel-line mr-2"></i>Export to CSV
                                        </button>
                                        <button class="w-full bg-blue-600 hover:bg-blue-700 text-white py-2 px-4 rounded-lg transition-all duration-200 font-medium shadow-lg hover:shadow-xl hover:scale-105">
                                            <i class="ri-file-code-line mr-2"></i>Export to JSON
                                        </button>
                                    </div>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-slate-400 mb-2">Import Data</label>
                                    <input type="file" id="import-file" accept=".csv,.json"
                                           class="w-full px-3 py-2 bg-slate-700 border border-slate-600 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary text-white file:mr-4 file:py-2 file:px-4 file:rounded-lg file:border-0 file:text-sm file:font-medium file:bg-primary file:text-slate-900 hover:file:bg-primary/90">
                                    <button class="w-full mt-2 bg-orange-600 hover:bg-orange-700 text-white py-2 px-4 rounded-lg transition-all duration-200 font-medium shadow-lg hover:shadow-xl hover:scale-105">
                                        <i class="ri-upload-cloud-line mr-2"></i>Import Data
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- Database Backup -->
                        <div class="card bg-slate-800/50 border border-slate-700 rounded-lg p-4 md:p-6">
                            <h3 class="text-lg font-semibold text-white mb-4">
                                <i class="ri-database-2-line mr-2 text-primary"></i>Database Backup
                            </h3>
                            <form id="backup-form" class="space-y-4">
                                <div class="flex items-center">
                                    <input type="checkbox" id="auto-backup" checked class="h-4 w-4 text-primary focus:ring-primary border-slate-600 bg-slate-700 rounded">
                                    <label for="auto-backup" class="ml-2 block text-sm text-slate-300">Enable automatic backups</label>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-slate-400 mb-2">Backup Frequency</label>
                                    <select id="backup-frequency" class="w-full px-3 py-2 bg-slate-700 border border-slate-600 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary text-white">
                                        <option value="daily" selected>Daily</option>
                                        <option value="weekly">Weekly</option>
                                        <option value="monthly">Monthly</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-slate-400 mb-2">Backup Retention</label>
                                    <select id="backup-retention" class="w-full px-3 py-2 bg-slate-700 border border-slate-600 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary text-white">
                                        <option value="7">7 days</option>
                                        <option value="30" selected>30 days</option>
                                        <option value="90">90 days</option>
                                    </select>
                                </div>
                                <button type="button" class="w-full bg-purple-600 hover:bg-purple-700 text-white py-2 px-4 rounded-lg transition-all duration-200 font-medium shadow-lg hover:shadow-xl hover:scale-105">
                                    <i class="ri-download-line mr-2"></i>Create Backup Now
                                </button>
                                <button type="submit" class="w-full bg-primary hover:bg-primary/90 text-slate-900 py-2 px-4 rounded-lg transition-all duration-200 font-medium shadow-lg hover:shadow-xl hover:scale-105">
                                    Save Backup Settings
                                </button>
                            </form>
                        </div>

                        <!-- Asset Cleanup -->
                        <div class="card bg-slate-800/50 border border-slate-700 rounded-lg p-4 md:p-6">
                            <h3 class="text-lg font-semibold text-white mb-4">
                                <i class="ri-delete-bin-line mr-2 text-primary"></i>Asset Cleanup Rules
                            </h3>
                            <form id="cleanup-form" class="space-y-4">
                                <div class="flex items-center">
                                    <input type="checkbox" id="auto-cleanup" class="h-4 w-4 text-primary focus:ring-primary border-slate-600 bg-slate-700 rounded">
                                    <label for="auto-cleanup" class="ml-2 block text-sm text-slate-300">Enable automatic cleanup</label>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-slate-400 mb-2">Remove inactive assets after</label>
                                    <select id="inactive-threshold" class="w-full px-3 py-2 bg-slate-700 border border-slate-600 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary text-white">
                                        <option value="30">30 days</option>
                                        <option value="90" selected>90 days</option>
                                        <option value="180">6 months</option>
                                        <option value="365">1 year</option>
                                    </select>
                                </div>
                                <div class="flex items-center">
                                    <input type="checkbox" id="cleanup-resolved" class="h-4 w-4 text-primary focus:ring-primary border-slate-600 bg-slate-700 rounded">
                                    <label for="cleanup-resolved" class="ml-2 block text-sm text-slate-300">Remove resolved vulnerabilities after 90 days</label>
                                </div>
                                <button type="submit" class="w-full bg-primary hover:bg-primary/90 text-slate-900 py-2 px-4 rounded-lg transition-all duration-200 font-medium shadow-lg hover:shadow-xl hover:scale-105">
                                    Save Cleanup Rules
                                </button>
                            </form>
                        </div>
                    </div>
                </div>

                <!-- Integrations Tab -->
                <div id="integrations-tab" class="tab-content hidden">
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <!-- API Settings -->
                        <div class="card bg-slate-800/50 border border-slate-700 rounded-lg p-4 md:p-6">
                            <h3 class="text-lg font-semibold text-white mb-4">
                                <i class="ri-code-line mr-2 text-primary"></i>API Configuration
                            </h3>
                            <div class="space-y-4">
                                <div>
                                    <label class="block text-sm font-medium text-slate-400 mb-2">API Key</label>
                                    <div class="flex">
                                        <input type="password" id="api-key" value="sk-1234567890abcdef" readonly
                                               class="flex-1 px-3 py-2 bg-slate-700 border border-slate-600 rounded-l-lg focus:ring-2 focus:ring-primary focus:border-primary text-white">
                                        <button type="button" onclick="toggleApiKey()" class="px-3 py-2 bg-slate-600 border border-l-0 border-slate-600 rounded-r-lg hover:bg-slate-500 text-slate-300">
                                            <i class="ri-eye-line"></i>
                                        </button>
                                    </div>
                                </div>
                                <div class="flex space-x-2">
                                    <button class="flex-1 bg-primary hover:bg-primary/90 text-slate-900 py-2 px-4 rounded-lg transition-all duration-200 font-medium shadow-lg hover:shadow-xl hover:scale-105">
                                        <i class="ri-refresh-line mr-2"></i>Regenerate
                                    </button>
                                    <button class="flex-1 bg-slate-600 hover:bg-slate-500 text-white py-2 px-4 rounded-lg transition-all duration-200 font-medium shadow-lg hover:shadow-xl hover:scale-105">
                                        <i class="ri-file-copy-line mr-2"></i>Copy
                                    </button>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-slate-400 mb-2">Rate Limit</label>
                                    <select id="api-rate-limit" class="w-full px-3 py-2 bg-slate-700 border border-slate-600 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary text-white">
                                        <option value="100">100 requests/hour</option>
                                        <option value="500" selected>500 requests/hour</option>
                                        <option value="1000">1000 requests/hour</option>
                                        <option value="unlimited">Unlimited</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <!-- Webhook Settings -->
                        <div class="card bg-slate-800/50 border border-slate-700 rounded-lg p-4 md:p-6">
                            <h3 class="text-lg font-semibold text-white mb-4">
                                <i class="ri-webhook-line mr-2 text-primary"></i>Webhook Configuration
                            </h3>
                            <form id="webhook-form" class="space-y-4">
                                <div class="flex items-center">
                                    <input type="checkbox" id="webhooks-enabled" class="h-4 w-4 text-primary focus:ring-primary border-slate-600 bg-slate-700 rounded">
                                    <label for="webhooks-enabled" class="ml-2 block text-sm text-slate-300">Enable webhooks</label>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-slate-400 mb-2">Webhook URL</label>
                                    <input type="url" id="webhook-url" placeholder="https://your-app.com/webhook"
                                           class="w-full px-3 py-2 bg-slate-700 border border-slate-600 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary text-white placeholder-slate-400">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-slate-400 mb-2">Events</label>
                                    <div class="space-y-2">
                                        <div class="flex items-center">
                                            <input type="checkbox" id="webhook-new-vuln" checked class="h-4 w-4 text-primary focus:ring-primary border-slate-600 bg-slate-700 rounded">
                                            <label for="webhook-new-vuln" class="ml-2 block text-sm text-slate-300">New vulnerability discovered</label>
                                        </div>
                                        <div class="flex items-center">
                                            <input type="checkbox" id="webhook-scan-complete" class="h-4 w-4 text-primary focus:ring-primary border-slate-600 bg-slate-700 rounded">
                                            <label for="webhook-scan-complete" class="ml-2 block text-sm text-slate-300">Scan completed</label>
                                        </div>
                                        <div class="flex items-center">
                                            <input type="checkbox" id="webhook-new-asset" class="h-4 w-4 text-primary focus:ring-primary border-slate-600 bg-slate-700 rounded">
                                            <label for="webhook-new-asset" class="ml-2 block text-sm text-slate-300">New asset discovered</label>
                                        </div>
                                    </div>
                                </div>
                                <button type="submit" class="w-full bg-primary hover:bg-primary/90 text-slate-900 py-2 px-4 rounded-lg transition-all duration-200 font-medium shadow-lg hover:shadow-xl hover:scale-105">
                                    Save Webhook Settings
                                </button>
                            </form>
                        </div>

                        <!-- Third-party Integrations -->
                        <div class="card bg-slate-800/50 border border-slate-700 rounded-lg p-4 md:p-6 lg:col-span-2">
                            <h3 class="text-lg font-semibold text-white mb-4">
                                <i class="ri-links-line mr-2 text-primary"></i>Third-party Integrations
                            </h3>
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                <div class="p-4 bg-slate-700/50 border border-slate-600 rounded-lg">
                                    <div class="flex items-center justify-between mb-3">
                                        <div class="flex items-center">
                                            <i class="ri-slack-line text-2xl text-purple-400 mr-3"></i>
                                            <span class="font-medium text-white">Slack</span>
                                        </div>
                                        <span class="px-2 py-1 text-xs bg-slate-500/20 text-slate-400 border border-slate-500/30 rounded-full">Not Connected</span>
                                    </div>
                                    <button class="w-full bg-purple-600 hover:bg-purple-700 text-white py-2 px-4 rounded-lg transition-all duration-200 font-medium shadow-lg hover:shadow-xl hover:scale-105">
                                        Connect
                                    </button>
                                </div>
                                <div class="p-4 bg-slate-700/50 border border-slate-600 rounded-lg">
                                    <div class="flex items-center justify-between mb-3">
                                        <div class="flex items-center">
                                            <i class="ri-microsoft-line text-2xl text-blue-400 mr-3"></i>
                                            <span class="font-medium text-white">Teams</span>
                                        </div>
                                        <span class="px-2 py-1 text-xs bg-slate-500/20 text-slate-400 border border-slate-500/30 rounded-full">Not Connected</span>
                                    </div>
                                    <button class="w-full bg-blue-600 hover:bg-blue-700 text-white py-2 px-4 rounded-lg transition-all duration-200 font-medium shadow-lg hover:shadow-xl hover:scale-105">
                                        Connect
                                    </button>
                                </div>
                                <div class="p-4 bg-slate-700/50 border border-slate-600 rounded-lg">
                                    <div class="flex items-center justify-between mb-3">
                                        <div class="flex items-center">
                                            <i class="ri-mail-line text-2xl text-red-400 mr-3"></i>
                                            <span class="font-medium text-white">Email</span>
                                        </div>
                                        <span class="px-2 py-1 text-xs bg-green-500/20 text-green-400 border border-green-500/30 rounded-full">Connected</span>
                                    </div>
                                    <button class="w-full bg-slate-600 hover:bg-slate-500 text-white py-2 px-4 rounded-lg transition-all duration-200 font-medium shadow-lg hover:shadow-xl hover:scale-105">
                                        Configure
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>


            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block styles %}
<style>
/* Custom slider styling for dark theme */
.slider::-webkit-slider-thumb {
    appearance: none;
    height: 20px;
    width: 20px;
    border-radius: 50%;
    background: #10b981;
    cursor: pointer;
    border: 2px solid #0f172a;
}

.slider::-moz-range-thumb {
    height: 20px;
    width: 20px;
    border-radius: 50%;
    background: #10b981;
    cursor: pointer;
    border: 2px solid #0f172a;
}

.slider::-webkit-slider-track {
    height: 8px;
    border-radius: 4px;
    background: #475569;
}

.slider::-moz-range-track {
    height: 8px;
    border-radius: 4px;
    background: #475569;
}
</style>
{% endblock %}

{% block scripts %}
<script>
// Global variables
let isMobile = false;

// Check if mobile
function checkMobile() {
    return window.innerWidth < 1024;
}

// Initialize page
document.addEventListener('DOMContentLoaded', function() {
    initializeSidebar();
    initializeMobileSidebar();
    initializeTabSwitching();
    initializeFormHandlers();
    initializeSliders();

    // Navigation items with onclick handlers are handled automatically
    // No additional navigation handlers needed since all items now use onclick
});

// Sidebar functionality
function initializeSidebar() {
    const isExpanded = localStorage.getItem('sidebarExpanded') === 'true';
    if (isExpanded && !checkMobile()) {
        expandSidebar();
    }

    const sidebarToggle = document.getElementById('sidebar-toggle');
    if (sidebarToggle) {
        sidebarToggle.addEventListener('click', function() {
            if (checkMobile()) {
                toggleMobileSidebar();
            } else {
                toggleSidebar();
            }
        });
    }
}

function expandSidebar() {
    if (checkMobile()) return;

    const sidebar = document.getElementById('sidebar');
    const logoText = document.getElementById('logo-text');
    const navTexts = document.querySelectorAll('.nav-text');
    const toggleText = document.getElementById('toggle-text');

    sidebar.classList.remove('w-16');
    sidebar.classList.add('w-64');

    setTimeout(() => {
        logoText.classList.remove('opacity-0');
        navTexts.forEach(text => text.classList.remove('opacity-0'));
        toggleText.classList.remove('opacity-0');
        toggleText.textContent = 'Collapse';
    }, 150);

    localStorage.setItem('sidebarExpanded', 'true');
}

function collapseSidebar() {
    if (checkMobile()) return;

    const sidebar = document.getElementById('sidebar');
    const logoText = document.getElementById('logo-text');
    const navTexts = document.querySelectorAll('.nav-text');
    const toggleText = document.getElementById('toggle-text');

    logoText.classList.add('opacity-0');
    navTexts.forEach(text => text.classList.add('opacity-0'));
    toggleText.classList.add('opacity-0');

    setTimeout(() => {
        sidebar.classList.remove('w-64');
        sidebar.classList.add('w-16');
        toggleText.textContent = 'Expand';
    }, 150);

    localStorage.setItem('sidebarExpanded', 'false');
}

function toggleSidebar() {
    const sidebar = document.getElementById('sidebar');
    if (sidebar.classList.contains('w-64')) {
        collapseSidebar();
    } else {
        expandSidebar();
    }
}

// Mobile sidebar functionality
function initializeMobileSidebar() {
    const overlay = document.getElementById('sidebar-overlay');
    const mobileMenuBtn = document.getElementById('mobile-menu-btn');

    if (mobileMenuBtn) {
        mobileMenuBtn.addEventListener('click', toggleMobileSidebar);
    }

    if (overlay) {
        overlay.addEventListener('click', closeMobileSidebar);
    }

    // Close mobile sidebar when clicking nav items
    document.querySelectorAll('.nav-item').forEach(item => {
        item.addEventListener('click', () => {
            if (checkMobile()) {
                closeMobileSidebar();
            }
        });
    });
}

function toggleMobileSidebar() {
    const sidebar = document.getElementById('sidebar');

    if (sidebar.classList.contains('translate-x-0')) {
        closeMobileSidebar();
    } else {
        openMobileSidebar();
    }
}

function openMobileSidebar() {
    const sidebar = document.getElementById('sidebar');
    const overlay = document.getElementById('sidebar-overlay');

    sidebar.classList.remove('-translate-x-full');
    sidebar.classList.add('translate-x-0');
    sidebar.classList.add('fixed', 'z-50', 'w-64');

    if (overlay) {
        overlay.classList.remove('hidden');
    }

    // Show nav text immediately on mobile
    const navTexts = document.querySelectorAll('.nav-text');
    const logoText = document.getElementById('logo-text');
    navTexts.forEach(text => text.classList.remove('opacity-0'));
    if (logoText) logoText.classList.remove('opacity-0');
}

function closeMobileSidebar() {
    const sidebar = document.getElementById('sidebar');
    const overlay = document.getElementById('sidebar-overlay');

    sidebar.classList.remove('translate-x-0');
    sidebar.classList.add('-translate-x-full');

    if (overlay) {
        overlay.classList.add('hidden');
    }

    setTimeout(() => {
        sidebar.classList.remove('fixed', 'z-50', 'w-64');
        sidebar.classList.add('w-16');

        // Hide nav text on mobile when closed
        const navTexts = document.querySelectorAll('.nav-text');
        const logoText = document.getElementById('logo-text');
        navTexts.forEach(text => text.classList.add('opacity-0'));
        if (logoText) logoText.classList.add('opacity-0');
    }, 300);
}

function toggleUserMenu() {
    const menu = document.getElementById('userMenu');
    menu.classList.toggle('hidden');
}

// Close user menu when clicking outside
document.addEventListener('click', function(event) {
    const menu = document.getElementById('userMenu');
    const button = event.target.closest('button');
    if (!button || !button.onclick) {
        menu.classList.add('hidden');
    }
});

// Handle window resize
window.addEventListener('resize', function() {
    const wasMobile = isMobile;
    isMobile = checkMobile();

    if (wasMobile !== isMobile) {
        // Reset sidebar state when switching between mobile/desktop
        const sidebar = document.getElementById('sidebar');
        const overlay = document.getElementById('sidebar-overlay');

        if (isMobile) {
            closeMobileSidebar();
        } else {
            // Reset to desktop state
            sidebar.classList.remove('fixed', 'z-50', 'translate-x-0', '-translate-x-full');
            if (overlay) overlay.classList.add('hidden');

            // Apply saved desktop state
            const isExpanded = localStorage.getItem('sidebarExpanded') === 'true';
            if (isExpanded) {
                sidebar.classList.add('w-64');
                sidebar.classList.remove('w-16');
            } else {
                sidebar.classList.add('w-16');
                sidebar.classList.remove('w-64');
            }
        }
    }
});

// Tab switching functionality
function initializeTabSwitching() {
    document.querySelectorAll('.settings-tab').forEach(tab => {
        tab.addEventListener('click', function() {
            const tabName = this.getAttribute('data-tab');
            switchTab(tabName);
        });
    });
}

function switchTab(tabName) {
    // Update tab buttons - remove active state from all tabs
    document.querySelectorAll('.settings-tab').forEach(tab => {
        tab.classList.remove('active', 'bg-primary', 'text-slate-900');
        tab.classList.add('text-slate-400', 'hover:text-white', 'hover:bg-slate-700/50');
    });

    // Add active state to clicked tab
    const activeTab = document.querySelector(`[data-tab="${tabName}"]`);
    if (activeTab) {
        activeTab.classList.add('active', 'bg-primary', 'text-slate-900');
        activeTab.classList.remove('text-slate-400', 'hover:text-white', 'hover:bg-slate-700/50');
    }

    // Show/hide tab content
    document.querySelectorAll('.tab-content').forEach(content => {
        content.classList.add('hidden');
    });

    const activeContent = document.getElementById(`${tabName}-tab`);
    if (activeContent) {
        activeContent.classList.remove('hidden');
    }
}

// Form handlers
function initializeFormHandlers() {
    // Organization form
    document.getElementById('organization-form').addEventListener('submit', function(e) {
        e.preventDefault();
        saveOrganizationSettings();
    });

    // Interface form
    document.getElementById('interface-form').addEventListener('submit', function(e) {
        e.preventDefault();
        saveInterfaceSettings();
    });

    // Auto-scan form
    document.getElementById('autoscan-form').addEventListener('submit', function(e) {
        e.preventDefault();
        saveAutoscanSettings();
    });

    // Add more form handlers as needed
}

// Slider functionality
function initializeSliders() {
    const concurrentSlider = document.getElementById('concurrent-scans');
    const concurrentValue = document.getElementById('concurrent-value');

    if (concurrentSlider && concurrentValue) {
        concurrentSlider.addEventListener('input', function() {
            concurrentValue.textContent = this.value;
        });
    }
}

// Settings save functions
function saveOrganizationSettings() {
    const orgName = document.getElementById('org-name').value;
    const primaryDomain = document.getElementById('primary-domain').value;
    const orgDescription = document.getElementById('org-description').value;

    // Show success message
    showNotification('Organization settings saved successfully!', 'success');
}

function saveInterfaceSettings() {
    const defaultView = document.getElementById('default-view').value;
    const theme = document.getElementById('theme').value;
    const itemsPerPage = document.getElementById('items-per-page').value;
    const sidebarExpanded = document.getElementById('sidebar-expanded').checked;

    // Save to localStorage
    localStorage.setItem('defaultView', defaultView);
    localStorage.setItem('theme', theme);
    localStorage.setItem('itemsPerPage', itemsPerPage);
    localStorage.setItem('sidebarExpanded', sidebarExpanded);

    showNotification('Interface preferences saved successfully!', 'success');
}

function saveAutoscanSettings() {
    const autoScanEnabled = document.getElementById('auto-scan-enabled').checked;
    const scanFrequency = document.getElementById('scan-frequency').value;
    const scanTime = document.getElementById('scan-time').value;
    const deepScan = document.getElementById('deep-scan').checked;

    showNotification('Auto-scan settings saved successfully!', 'success');
}

// Utility functions
function showNotification(message, type = 'info') {
    // Create notification element
    const notification = document.createElement('div');
    notification.className = `fixed top-4 right-4 z-50 p-4 rounded-lg shadow-lg ${
        type === 'success' ? 'bg-green-100 text-green-700 border border-green-300' :
        type === 'error' ? 'bg-red-100 text-red-700 border border-red-300' :
        'bg-blue-100 text-blue-700 border border-blue-300'
    }`;

    notification.innerHTML = `
        <div class="flex items-center justify-between">
            <span>${message}</span>
            <button onclick="this.parentElement.parentElement.remove()" class="ml-4 text-lg font-bold">&times;</button>
        </div>
    `;

    document.body.appendChild(notification);

    // Auto-remove after 5 seconds
    setTimeout(() => {
        if (notification.parentElement) {
            notification.remove();
        }
    }, 5000);
}

function toggleApiKey() {
    const apiKeyInput = document.getElementById('api-key');
    const eyeIcon = document.querySelector('#api-key').nextElementSibling.querySelector('i');

    if (apiKeyInput.type === 'password') {
        apiKeyInput.type = 'text';
        eyeIcon.classList.remove('ri-eye-line');
        eyeIcon.classList.add('ri-eye-off-line');
    } else {
        apiKeyInput.type = 'password';
        eyeIcon.classList.remove('ri-eye-off-line');
        eyeIcon.classList.add('ri-eye-line');
    }
}
</script>
{% endblock %}
